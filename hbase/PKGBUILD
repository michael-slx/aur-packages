# Maintainer: Evan Goldenberg <evangoldenberg@gmail.com>

pkgname='hbase'
pkgver=2.3.0
pkgrel=1
pkgdesc='HBase - the Hadoop database'
arch=('i686' 'x86_64')
url='https://hbase.apache.org'
license=('apache')
depends=('java-environment>=7')
backup=(
  "etc/${pkgname}/hadoop-metrics2-hbase.properties"
  "etc/${pkgname}/hbase-env.cmd"
  "etc/${pkgname}/hbase-env.sh"
  "etc/${pkgname}/hbase-policy.xml"
  "etc/${pkgname}/hbase-site.xml"
  "etc/${pkgname}/log4j.properties"
  "etc/${pkgname}/regionservers"
)
install="${pkgname}.install"
source=(
  "https://downloads.apache.org/hbase/$pkgver/hbase-$pkgver-bin.tar.gz"
  'hbase.install'
  'hbase.profile'
  'hbase.service'
  'hbase-site.xml'
)
sha512sums=('5fb64fabfb6ead01527ece6e10be3d953681d09d6295883c966379f716c62e2fc289ae59609d7c1fe01296258e456d85516b7cfab0b962057a6713db6401a127'
            'a7541e0e6ec55965386b808bedc8914ba68d6b585cff7dcc7bb44723aaba013142bf5dea16d64e13a748b7c1fff8754e437e16ac88c388c49f022a1bd5416cbf'
            '481585f185b2645ec6eb7202f62b3d096540eee23f63e1971a0df6ac23a8d4372c54651ca3b4ab72f02fdca296bb1c2a5f5655b82101c040369f71f7b49d4618'
            'd91949bc5850d97f62a96551ae4904e6b4d591e044b84049773319383b256bf1465cb6a247cb830dd466bc8a1444853829e0a2336ca3d4815a993362a59a34a4'
            '85d5e32c751da08257fea903e1da4b71463e01b3d2aeefc5e33fc6b1f3bc520cee07db1eb5eabf06a385af465e0db1f94c940742d0ff5bb46a8a7bed75d63a61')
_watch="https://hbase.apache.org/downloads.html"

package() {
  cd "$srcdir/${pkgname}-${pkgver}"
  install -d "$pkgdir/usr/bin" "$pkgdir/opt" "$pkgdir/etc/hbase" "$pkgdir/usr/lib/systemd/system"
  install -d "$pkgdir/var/log/hbase" "$pkgdir/var/lib/hbase"
  cp -r "$srcdir/${pkgname}-${pkgver}" "$pkgdir/opt/hbase"

  cd "$pkgdir/usr/bin"
  for binary in hbase hbase-config.sh start-hbase.sh stop-hbase.sh; do
    ln -s "/opt/hbase/bin/$binary" $binary
  done

  install -Dm755 "$srcdir/hbase.profile" "$pkgdir/etc/profile.d/hbase.sh"
  install -Dm644 "$srcdir/hbase.service" "$pkgdir/usr/lib/systemd/system/hbase.service"
  install -Dm644 "$srcdir/${pkgname}-${pkgver}/conf"/* "$pkgdir/etc/hbase"
  install -Dm644 "$srcdir/hbase-site.xml" "$pkgdir/etc/hbase/hbase-site.xml"

  cd "$pkgdir/opt/hbase"
  mv conf conf-templates
  ln -sf "/etc/hbase" conf
}
