# Maintainer: Michael Schantl <floss at schantl dash lx dot at>
# Contributor: Evan Goldenberg <evangoldenberg@gmail.com>

pkgname='hbase'
pkgver=2.3.1
pkgrel=1
pkgdesc='HBase - the Hadoop database'
arch=('i686' 'x86_64')
url='https://hbase.apache.org'
license=('apache')
depends=('java-environment>=8')
backup=(
  "etc/${pkgname}/hadoop-metrics2-hbase.properties"
  "etc/${pkgname}/hbase-env.sh"
  "etc/${pkgname}/hbase-policy.xml"
  "etc/${pkgname}/hbase-site.xml"
  "etc/${pkgname}/log4j.properties"
  "etc/${pkgname}/regionservers"
)
install="${pkgname}.install"
source=(
  "https://downloads.apache.org/hbase/$pkgver/hbase-$pkgver-bin.tar.gz"
  'hbase.install'
  'hbase.profile'
  'hbase.service'
  'hbase-site.xml'
)
sha512sums=('3192d22ed15dfc33bb41869fc14a3d4e6b141aff94b21366f63ca750d32b1eed985e491a952990c36ae6d9257b40b52e0829c3f4f5d9bfdfe04ab66293eea76f'
            '38db08094c63977fd21ee6afa806b474196697549c1f9418d902617d821676f452997ac5164401847a36deeef721f43dc146bf697f4a2979dcd370fd8f200d75'
            '43d421e2f1b0e8330f8564a25cea257f3e7e67afb6ad8ff47c6ebd0af9685c8564090b4f764a9d9d11dc2f88a454de3c2f9ed5c86638fd8c0a498bab3fae1cb5'
            'ebc4b05a55f03fa75b7b37961e9a3d1389ef4b051f6e02ec36363cac7d3f5aa4c799aa90b01548ada385d02c9f97f30c0908a2f7e88efbb0d2cfe594d6654717'
            '25e0b5a7ba3165d2c1dcb842a83eea3d975066e30f17fa9f8273ed36b2e4e79fec34f9a9ecbd2e5c5a35946b6e73e05a031443b967cad78e5ce48ec9657bbd6a')
_watch="https://hbase.apache.org/downloads.html"

package() {
  cd "$srcdir/${pkgname}-${pkgver}"
  install -d \
    "$pkgdir/etc/hbase" \
    "$pkgdir/opt" \
    "$pkgdir/usr/bin" \
    "$pkgdir/usr/lib/systemd/system"
  cp -r "$srcdir/${pkgname}-${pkgver}" "$pkgdir/opt/hbase"

  cd "$pkgdir/usr/bin"
  for binary in hbase hbase-config.sh start-hbase.sh stop-hbase.sh; do
    ln -s "/opt/hbase/bin/$binary" $binary
  done

  install -Dm755 "$srcdir/hbase.profile" "$pkgdir/etc/profile.d/hbase.sh"
  install -Dm644 "$srcdir/hbase.service" "$pkgdir/usr/lib/systemd/system/hbase.service"
  install -Dm644 "$srcdir/${pkgname}-${pkgver}/conf"/* "$pkgdir/etc/hbase"
  rm "$pkgdir/etc/hbase/hbase-env.cmd"
  install -Dm644 "$srcdir/hbase-site.xml" "$pkgdir/etc/hbase/hbase-site.xml"

  cd "$pkgdir/opt/hbase"
  mv conf conf-templates
  ln -sf "/etc/hbase" conf
}
